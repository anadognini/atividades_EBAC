# -*- coding: utf-8 -*-
"""transforme_em_funcoes.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1dTXSu-ACK5F35dfYOIFakMTLBJwUgr9C
"""

import psycopg2 as pg2
import pandas as pd

def connect_to_postgres(dbname, port, password):
    conn = None

    try:
        conn = pg2.connect(host='localhost', port=port, dbname=dbname,
                           user='postgres', password=password)
    except Exception as e:
        print(e)
        conn = None

    return conn

def get_result_query(conn, query, fetch='all'):
    data = None
    colnames = None

    try:
        cur = conn.cursor()
        cur.execute(query)
        conn.commit()

        if fetch == 'all':
            data = cur.fetchall()
        elif fetch == 'many':
            data = cur.fetchmany()
        elif fetch == 'one':
            data = cur.fetchone()
        else:
            data = None
            return data

        colnames = [desc.name for desc in cur.description]
        cur.close()
        conn.close()
    except Exception as e:
        print(e)
        cur.close()
        conn.close()

    return data, colnames

def to_df(data, colnames):
    return pd.DataFrame(data, columns=colnames)

dbname = 'dvdrental'
query = 'SELECT * FROM film'
port = 5432
password = 'senha'

conn = connect_to_postgres(dbname, port, password)
data, colnames = get_result_query(conn, query, fetch='all')
df = to_df(data, colnames)

df.head()

